<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error-log {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success-log {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .iframe-container {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            background: white;
            position: relative;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 6px;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .error { color: #f14c4c; }
        .warning { color: #ffcc02; }
        .info { color: #3794ff; }
        .success { color: #73c991; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        
        <div class="success-log">
            <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ:</h3>
            <div id="diagnosis-info">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>
        </div>

        <div>
            <button class="btn" onclick="checkNetworkRequests()">ğŸŒ ÙØ­Øµ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©</button>
            <button class="btn" onclick="checkConsoleErrors()">ğŸ› ÙØ­Øµ Ø£Ø®Ø·Ø§Ø¡ Console</button>
            <button class="btn" onclick="testDirectAccess()">ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</button>
            <button class="btn" onclick="loadAdminWithDebug()">ğŸ”§ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ Ø§Ù„ØªØ´Ø®ÙŠØµ</button>
            <button class="btn" onclick="clearCache()">ğŸ—‘ï¸ Ù…Ø³Ø­ Cache</button>
        </div>

        <div class="console-output" id="console-output">
            <div class="info">ğŸš€ Ø¨Ø¯Ø¡ ØªØ´Ø®ÙŠØµ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡...</div>
        </div>

        <div class="iframe-container" id="iframe-container" style="display: none;">
            <h3>ğŸ“± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…ÙØ­Ù…Ù‘Ù„Ø© Ù…Ø¹ Ø§Ù„ØªØ´Ø®ÙŠØµ:</h3>
            <iframe id="admin-iframe" src=""></iframe>
            <div id="iframe-errors" class="error-log" style="display: none;"></div>
        </div>

        <div id="network-analysis" class="error-log" style="display: none;">
            <h4>ğŸŒ ØªØ­Ù„ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©:</h4>
            <div id="network-details"></div>
        </div>
    </div>

    <script>
        const output = document.getElementById('console-output');
        const diagnosisInfo = document.getElementById('diagnosis-info');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function updateDiagnosis(info) {
            diagnosisInfo.innerHTML = info;
        }

        // ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        window.onload = function() {
            log('ğŸ” Ø¨Ø¯Ø¡ ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', 'info');
            
            updateDiagnosis(`
                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString('ar-SA')}
                Ø§Ù„Ù…ØªØµÙØ­: ${navigator.userAgent.split(' ').pop()}
                Ø§Ù„Ø´Ø§Ø´Ø©: ${screen.width}x${screen.height}
                JavaScript: Ù…ÙÙØ¹Ù‘Ù„ âœ…
            `);

            // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø®ÙˆØ§Ø¯Ù…
            setTimeout(checkServers, 1000);
        };

        async function checkServers() {
            log('ğŸ–¥ï¸ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø¯Ù…...', 'info');
            
            try {
                // ÙØ­Øµ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ
                const frontendResponse = await fetch('http://localhost:5177/');
                if (frontendResponse.ok) {
                    log('âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ ÙŠØ¹Ù…Ù„ (Port 5177)', 'success');
                } else {
                    log(`âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ: ${frontendResponse.status}`, 'error');
                }

                // ÙØ­Øµ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ
                const backendResponse = await fetch('http://localhost:5000/api/health');
                if (backendResponse.ok) {
                    log('âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ ÙŠØ¹Ù…Ù„ (Port 5000)', 'success');
                } else {
                    log(`âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ: ${backendResponse.status}`, 'error');
                }

                // ÙØ­Øµ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
                const adminResponse = await fetch('http://localhost:5177/admin');
                if (adminResponse.ok) {
                    const content = await adminResponse.text();
                    if (content.includes('<div id="root">')) {
                        log('âœ… ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙˆØµÙˆÙ„', 'success');
                        log('ğŸ” Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ React root div', 'info');
                    } else {
                        log('âš ï¸ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ React root', 'warning');
                    }
                } else {
                    log(`âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†: ${adminResponse.status}`, 'error');
                }

            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø®ÙˆØ§Ø¯Ù…: ${error.message}`, 'error');
            }
        }

        async function checkNetworkRequests() {
            log('ğŸŒ ÙØ­Øµ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„ØµÙØ­Ø©...', 'info');
            document.getElementById('network-analysis').style.display = 'block';
            
            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ­Ù…Ù‘Ù„
            const criticalFiles = [
                'http://localhost:5177/',
                'http://localhost:5177/src/main.tsx',
                'http://localhost:5177/src/App.tsx',
                'http://localhost:5177/src/pages/admin/AdminPage.tsx'
            ];

            const networkDetails = document.getElementById('network-details');
            networkDetails.innerHTML = '';

            for (const file of criticalFiles) {
                try {
                    const response = await fetch(file);
                    const status = response.ok ? 'âœ…' : 'âŒ';
                    const size = response.headers.get('content-length') || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    networkDetails.innerHTML += `${status} ${file} - ${response.status} (${size} bytes)\n`;
                    
                    if (response.ok) {
                        log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„: ${file}`, 'success');
                    } else {
                        log(`âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„: ${file} - ${response.status}`, 'error');
                    }
                } catch (error) {
                    networkDetails.innerHTML += `âŒ ${file} - Ø®Ø·Ø£: ${error.message}\n`;
                    log(`âŒ Ø®Ø·Ø£ Ø´Ø¨ÙƒØ©: ${file} - ${error.message}`, 'error');
                }
            }
        }

        function checkConsoleErrors() {
            log('ğŸ› ÙØ­Øµ Ø£Ø®Ø·Ø§Ø¡ Console...', 'info');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ console.error Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.error = function(...args) {
                log(`ğŸ”´ Console Error: ${args.join(' ')}`, 'error');
                originalError.apply(console, args);
            };
            
            console.warn = function(...args) {
                log(`ğŸŸ¡ Console Warning: ${args.join(' ')}`, 'warning');
                originalWarn.apply(console, args);
            };
            
            log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø®Ø·Ø§Ø¡ Console', 'success');
        }

        async function testDirectAccess() {
            log('ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†...', 'info');
            
            try {
                const response = await fetch('http://localhost:5177/admin', {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });
                
                if (response.ok) {
                    const html = await response.text();
                    log('âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ HTML Ù„Ù„ØµÙØ­Ø©', 'success');
                    log(`ğŸ“„ Ø­Ø¬Ù… HTML: ${html.length} Ø­Ø±Ù`, 'info');
                    
                    // ÙØ­Øµ Ù…Ø­ØªÙˆÙ‰ HTML
                    if (html.includes('react')) {
                        log('âœ… Ø§Ù„ØµÙØ­Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ React', 'success');
                    }
                    if (html.includes('vite')) {
                        log('âœ… Ø§Ù„ØµÙØ­Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Vite', 'success');
                    }
                    if (html.includes('<div id="root">')) {
                        log('âœ… Ø§Ù„ØµÙØ­Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ React root div', 'success');
                    }
                    if (html.includes('main.tsx')) {
                        log('âœ… Ø§Ù„ØµÙØ­Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ main.tsx script', 'success');
                    }
                    
                } else {
                    log(`âŒ ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±: ${error.message}`, 'error');
            }
        }

        function loadAdminWithDebug() {
            log('ğŸ”§ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø¹ Ø§Ù„ØªØ´Ø®ÙŠØµ...', 'info');
            
            const iframe = document.getElementById('admin-iframe');
            const container = document.getElementById('iframe-container');
            const errorsDiv = document.getElementById('iframe-errors');
            
            container.style.display = 'block';
            iframe.src = 'http://localhost:5177/admin';
            
            iframe.onload = function() {
                log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ iframe', 'success');
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ console ÙÙŠ iframe
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (iframeDoc) {
                        log('âœ… ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø­ØªÙˆÙ‰ iframe', 'success');
                        
                        // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ React root
                        const rootDiv = iframeDoc.getElementById('root');
                        if (rootDiv) {
                            log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ React root div', 'success');
                            if (rootDiv.children.length > 0) {
                                log('âœ… React root div ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ±', 'success');
                            } else {
                                log('âš ï¸ React root div ÙØ§Ø±Øº - Ù‡Ù†Ø§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©!', 'warning');
                            }
                        } else {
                            log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ React root div', 'error');
                        }
                    }
                } catch (error) {
                    log(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø­ØªÙˆÙ‰ iframe: ${error.message}`, 'warning');
                }
            };
            
            iframe.onerror = function(error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ iframe: ${error}`, 'error');
                errorsDiv.style.display = 'block';
                errorsDiv.textContent = `Ø®Ø·Ø£ iframe: ${error}`;
            };
        }

        function clearCache() {
            log('ğŸ—‘ï¸ Ù…Ø³Ø­ Cache Ø§Ù„Ù…ØªØµÙØ­...', 'info');
            
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                    log('âœ… ØªÙ… Ù…Ø³Ø­ Service Worker caches', 'success');
                });
            }
            
            // Ù…Ø³Ø­ localStorage
            try {
                localStorage.clear();
                log('âœ… ØªÙ… Ù…Ø³Ø­ localStorage', 'success');
            } catch (error) {
                log(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­ localStorage: ${error.message}`, 'warning');
            }
            
            // Ù…Ø³Ø­ sessionStorage
            try {
                sessionStorage.clear();
                log('âœ… ØªÙ… Ù…Ø³Ø­ sessionStorage', 'success');
            } catch (error) {
                log(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­ sessionStorage: ${error.message}`, 'warning');
            }
            
            log('ğŸ’¡ Ù„Ù…Ø³Ø­ cache Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø§Ø¶ØºØ· Ctrl+Shift+R', 'info');
        }

        // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ø©
        window.addEventListener('error', function(event) {
            log(`ğŸ”´ JavaScript Error: ${event.message} ÙÙŠ ${event.filename}:${event.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(event) {
            log(`ğŸ”´ Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
